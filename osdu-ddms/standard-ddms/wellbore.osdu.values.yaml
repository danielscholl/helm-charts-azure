#  Copyright Â© Microsoft Corporation
#
#  Licensed under the Apache License, Version 2.0 (the "License");
#  you may not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#
#       http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.


# FIXME: Specific to OSDU deployment
azure:
  keyvault: 
    secrets:
    - key: appinsight.key
      obj: appinsights-key

# FIXME: Specific to OSDU deployment
ingress:
  appGateway: 
    issuer: letsencrypt-prod-dns
    enableKeyvaultCert: false

deployment:
  podAnnotations:
    prometheus.io/path: /api/os-wellbore-ddms/metrics
    prometheus.io/port: "8080"
    prometheus.io/scrape: "true"

configuration:
  - service: &serviceName wellbore-ddms
    container:
      image: wellbore-ddms
      containerPort: 8080
    path: /api/os-wellbore-ddms
    probe:
      readiness: 
        path: /api/os-wellbore-ddms/healthz
      liveness: 
        path: /api/os-wellbore-ddms/healthz
    auth:
      disable:
        - "/api/os-wellbore-ddms/"
        - "/api/os-wellbore-ddms/about"
        - "/api/os-wellbore-ddms/ddms/v2/about"
        - "/api/os-wellbore-ddms/docs"
        - "/api/os-wellbore-ddms/openapi.json"
    config:
      CLOUD_PROVIDER: "az"
      SERVICE_NAME: "wellbore-ddms"
      OPENAPI_PREFIX: "/api/os-wellbore-ddms"
      KEYVAULT_URL: "https://{{ .Values.azure.keyvault.name }}.vault.azure.net/"
      SERVICE_HOST_STORAGE: "http://storage.osdu-azure/api/storage"
      SERVICE_HOST_SEARCH: "http://search.osdu-azure/api/search"
      SERVICE_HOST_PARTITION: "http://partition.osdu-azure/api/partition"
      USE_PARTITION_SERVICE: "enabled"
      AZ_LOGGER_LEVEL: "INFO"

    # FIXME: Specific to OSDU deployment
    secrets:
      - name: AZ_AI_INSTRUMENTATION_KEY
        key: appinsight.key

uri-pattern-filter:
  configuration:
  - name: *serviceName
    workloadSelector:
      labels:
        app.kubernetes.io/instance: *serviceName
    uriPatterns:
    - "/api/os-wellbore-ddms/about"
    - "/api/os-wellbore-ddms/version"
    - "/api/os-wellbore-ddms/v1/{type}/{id}/{version}"
    - "/api/os-wellbore-ddms/storage/v1/{type}/{id}/{version}"
    - "/api/os-wellbore-ddms/ddms/v3/fastquery/wellbore/{wellboreAttribute}/welllogs"
    - "/api/os-wellbore-ddms/ddms/v3/fastquery/wellbores"
    - "/api/os-wellbore-ddms/ddms/v3/fastquery/wellbores/{wellbore_id}/wellboremarkersets"
    - "/api/os-wellbore-ddms/ddms/v3/fastquery/wellbores/{wellbore_id}/welllogs"
    - "/api/os-wellbore-ddms/ddms/v3/query/wellbore/{wellboreAttribute}/welllogs"
    - "/api/os-wellbore-ddms/ddms/v3/query/wellbores"
    - "/api/os-wellbore-ddms/ddms/v3/query/wellbores/{wellbore_id}/wellboremarkersets"
    - "/api/os-wellbore-ddms/ddms/v3/query/wellbores/{wellbore_id}/welllogs"
    - "/api/os-wellbore-ddms/ddms/v3/records/delete"
    - "/api/os-wellbore-ddms/ddms/v3/wellboremarkersets"
    - "/api/os-wellbore-ddms/ddms/v3/wellboremarkersets/{wellboremarkersetid}"
    - "/api/os-wellbore-ddms/ddms/v3/wellboremarkersets/{wellboremarkersetid}/versions"
    - "/api/os-wellbore-ddms/ddms/v3/wellboremarkersets/{wellboremarkersetid}/versions/{version}"
    - "/api/os-wellbore-ddms/ddms/v3/wellbores"
    - "/api/os-wellbore-ddms/ddms/v3/wellbores/{wellboreid}"
    - "/api/os-wellbore-ddms/ddms/v3/wellbores/{wellboreid}/versions"
    - "/api/os-wellbore-ddms/ddms/v3/wellbores/{wellboreid}/versions/{version}"
    - "/api/os-wellbore-ddms/ddms/v3/wellboretrajectories/{record_id}/data"
    - "/api/os-wellbore-ddms/ddms/v3/wellboretrajectories/{record_id}/sessions"
    - "/api/os-wellbore-ddms/ddms/v3/wellboretrajectories/{record_id}/sessions/{session_id}"
    - "/api/os-wellbore-ddms/ddms/v3/wellboretrajectories/{record_id}/versions/{version}/data"
    - "/api/os-wellbore-ddms/ddms/v3/wellboretrajectories/{wellboretrajectoryid}"
    - "/api/os-wellbore-ddms/ddms/v3/wellboretrajectories/{wellboretrajectoryid}/versions"
    - "/api/os-wellbore-ddms/ddms/v3/wellboretrajectories/{wellboretrajectoryid}/versions/{version}"
    - "/api/os-wellbore-ddms/ddms/v3/welllogs"
    - "/api/os-wellbore-ddms/ddms/v3/welllogs/{record_id}/data"
    - "/api/os-wellbore-ddms/ddms/v3/welllogs/{record_id}/sessions"
    - "/api/os-wellbore-ddms/ddms/v3/welllogs/{record_id}/sessions/{session_id}"
    - "/api/os-wellbore-ddms/ddms/v3/welllogs/{record_id}/versions/{version}/data"
    - "/api/os-wellbore-ddms/ddms/v3/welllogs/{welllogid}"
    - "/api/os-wellbore-ddms/ddms/v3/welllogs/{welllogid}/versions"
    - "/api/os-wellbore-ddms/ddms/v3/welllogs/{welllogid}/versions/{version}"
    - "/api/os-wellbore-ddms/ddms/v3/wells"
    - "/api/os-wellbore-ddms/ddms/v3/wells/{well_id}"
    - "/api/os-wellbore-ddms/ddms/v3/wells/{well_id}/versions"
    - "/api/os-wellbore-ddms/ddms/v3/wells/{well_id}/versions/{version}"
    - "/api/os-wellbore-ddms/log-recognition/family"
    - "/api/os-wellbore-ddms/log-recognition/upload-catalog"
