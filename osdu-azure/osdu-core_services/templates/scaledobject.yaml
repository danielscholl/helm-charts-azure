{{- $namespace := .Release.namespace }}
{{- $serviceType := .Values.service.type }}
{{- $servicePort := .Values.service.port }}
{{- $release := .Release.Name }}
{{- range .Values.serverless }}
apiVersion: keda.k8s.io/v1alpha1
kind: ScaledObject
metadata:
  name: {{ .function }}
  namespace: {{ $namespace }}
  labels:
    deploymentName: {{ .function }}
spec:
  scaleTargetRef:
    deploymentName: {{ .function }}
  pollingInterval: 30  # Optional. Default: 30 seconds
  cooldownPeriod:  60  # Optional. Default: 300 seconds
  minReplicaCount: {{ .minReplicaCount }}
  maxReplicaCount: {{ .maxReplicaCount }}
  triggers:
  - type: azure-servicebus
    metadata:
      type: serviceBusTrigger
      direction: in
      name: message
      subscriptionName: {{ .servicebusSubscription }}
      topicName: {{ .servicebusTopic }}
      connection: SERVICE_BUS

---
{{- end }}
